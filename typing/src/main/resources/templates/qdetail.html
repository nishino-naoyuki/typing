<!--
=========================================================
* Argon Dashboard 2 - v2.0.4
=========================================================

* Product Page: https://www.creative-tim.com/product/argon-dashboard
* Copyright 2022 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ヘッダー -->
  <div id="parent" th:replace="/common/head"></div>  
</head>

<body class="g-sidenav-show   bg-gray-100">
  <div class="min-height-300 bg-primary position-absolute w-100"></div>
  
  <main class="main-content position-relative border-radius-lg ">
    <div class="container-fluid py-1">
      <div class="row">
        <div class="col-12 mb-4">
          <div class="card">
          	<div class="card-header">
          		<div class="row">
          			<div class="col">
	  					<p class="text-sm mb-0 text-uppercase font-weight-bold"><h2 th:text="${detailDto.title}"></h2></p>
          			</div>
          			<div class="col">
		        		<div class="d-flex justify-content-end mb-3">
		        			<div class="p-2" th:text="|難易度：${detailDto.difficulty}|"></div>
		        			<a href="javascript:;" class="btn btn-sm btn-info mb-0">問題編集</a>
		        		</div>
          			</div>
          		</div>
          	</div>
            <div class="card-body p-3">
              <div class="row">
		            <div class="card">
		            	<div class="card-header">
		            		<div class="row">
          						<div class="col">
		            				<h4>問題文</h4>
		            			</div>
          						<div class="col d-flex justify-content-end">
		            				<a href="javascript:change();" class="btn btn-sm btn-info mb-0">表示切替</a>
		            			</div>
		            		</div>
		            	</div>
		            	<div class="card-body">
		            		<div class="row mb-3">
		            			<div class="col d-flex justify-content-start">
		            				<a href="javascript:timerstart();" class="btn btn-sm btn-info mb-0">開始</a>　
		            				<a href="javascript:timerstop();" class="btn btn-sm btn-info mb-0">提出</a>　
		            			</div>
		            			<div class="col d-flex justify-content-start">
		            				<div id="pasttime" class="mb-1">経過時間 00:00</div>　
		            				<div id="inputlength" class="mb-1">文字数 0文字</div>　
		            			</div>
		            		</div>
		            		<div class="row">
			            		<div id="question" class="col-6 d-flex justify-content-start mb-3" th:text="${detailDto.sentence}">
								</div>
								<div class="form-group">
									<textarea class="form-control" id="answerarea" onkeyup="ShowLength(value);" rows="30" oncopy="return false" onpaste="return false" oncontextmenu="return false"></textarea>
								</div>
		            		</div>
		            	</div>
		            </div>
              </div>
            </div>
          </div>
        </div>
      </div>
	  <!--   FOOTER   -->
	  <div id="parent" th:replace="/common/footer"></div>  
    </div>
  </main>
  <!--   Core JS Files   -->
  <div id="parent" th:replace="/common/corejs"></div>  
  <script th:inline="javascript">
  	const change = ()=>{
  		let qestionobj = document.getElementById("question");
  		let formgrp = document.getElementById("sendform");
  		qestionobj.classList.toggle('col-6', !qestionobj.classList.contains('col-6'));
  		formgrp.classList.toggle('col-6', !formgrp.classList.contains('col-6'));
  	}
  	let timer;
  	let pasttime = document.getElementById("pasttime");
  	const answer = document.getElementById('answerarea');
  	let elapsedTime = 0;
  	let offsetTime = 0;
  	let keycount = 0;
  	let second = 0;
  	let nowTime;
  	const count = ()=>{
  		nowTime = new Date();

    	elapsedTime = Math.floor((nowTime - startTime) / 1000);
    	let minutes = Math.floor(elapsedTime/60);
    	second = elapsedTime % 60;
    	let str = '経過秒数 ' + minutes.toString().padStart(2, '0') + "分" + second.toString().padStart(2, '0')+ '秒';
    	pasttime.innerHTML  = str;
  	}
  	const timerstart = ()=>{
  		clearInterval(timer);
  		startTime = new Date();
  		timer = setInterval(count, 100);
  		document.getElementById("exampleFormControlTextarea1").value = "";
  	}
  	const timerstop = ()=>{
  		clearInterval(timer);
  		alert("本来はここでサーバー側で入力チェックが行われ、誤りがあるとメッセージとともにタイマーが再開される");
  		
 		const formData = new FormData();
 		formData.append('qid',/*[[${detailDto.qid}]]*/ );
 		formData.append('answer',answer.value );
 		formData.append('keycount',keycount );
 		formData.append('submitYear',nowTime.getFullYear() );
 		formData.append('submitMounth',nowTime.getMonth()+1 );
 		formData.append('submitday',nowTime.getDate() );
 		formData.append('submitHour',nowTime.getHours() );
 		formData.append('submitMinutes',nowTime.getMinutes() );
 		formData.append('submitSecond',nowTime.getSeconds() );
 		formData.append('time',second );
 		 		
        const url = /*[[@{/question/scoring}]]*/ "/question/scoring";
  		fetch(url,{method:"post",body: formData})
        //レスポンスの受け取り
        .then( response => response.json()).then(result => {
 			if( result.result != "OK"){
 				const errorText = document.getElementById('errrmessage');
 				var msgs = "";
 				for(var err of result.errorList ){
 					msgs += err.msg + "<BR>";
 				}
 				errorText.innerHTML = msgs;
 				alertarea.style.display = "block";
 			}else{
 				alert("登録完了\n【注意】このまま連続で登録をクリックすると同じものが登録されてしまいます！");
 			}
 		});
  	}
  	const ShowLength = ( str )=>{
  		keycount++;
	   document.getElementById("inputlength").innerHTML = "文字数:"+str.length + "文字";
	}
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
</body>

</html>